<div [class.blurred]="showLoginModal">
  <app-navbar></app-navbar>

  <!-- Main Container -->
  <div class="home-container">
    <!-- Ride Search Form -->
    <form (ngSubmit)="searchRides()" class="ride-form">
      <h2>Search Your Ride</h2>

      <!-- From Location Input -->
      <div class="form-group">
        
        <input
          type="text"
          [(ngModel)]="rideQuery.from"
          name="from"
          (input)="onFromInput($event.target.value)"
          placeholder="From"
          class="form-control"
          autocomplete="off"
          required
        />
        <ul *ngIf="filteredFromLocations.length" class="suggestions-list">
          <li
            *ngFor="let loc of filteredFromLocations"
            (click)="selectFromLocation(loc)"
          >
            {{ loc }}
          </li>
        </ul>
      </div>

      <!-- To Location Input -->
      <div class="form-group">
      
        <input
          type="text"
          [(ngModel)]="rideQuery.to"
          name="to"
          (input)="onToInput($event.target.value)"
          placeholder="To"
          class="form-control"
          autocomplete="off"
          required
        />
        <ul *ngIf="filteredToLocations.length" class="suggestions-list">
          <li
            *ngFor="let loc of filteredToLocations"
            (click)="selectToLocation(loc)"
          >
            {{ loc }}
          </li>
        </ul>
      </div>

      <!-- Date -->
      <div class="form-group">
       
        <input
          type="date"
          [(ngModel)]="rideQuery.date"
          name="date"
          class="form-control"
          required
        />
      </div>

      <!-- Passengers -->
      <div class="form-group">
        <input
          type="number"
          [(ngModel)]="rideQuery.passengers"
          name="passengers"
          min="1"
          placeholder="Passengers"
          class="form-control"
          required
        />
      </div>

      <button type="submit" class="btn btn-primary">Search</button>
    </form>

    <!-- Rides Result Section -->
    <div class="rides-list" *ngIf="rides.length > 0">
      <h3>Available Rides</h3>

      <div class="ride-cards">
        <div class="ride-card" *ngFor="let ride of rides">
          <div class="ride-header">
            <h4>
              {{ ride.from || ride.From || 'Unknown Source' }} ‚Üí
              {{ ride.to || ride.To || 'Unknown Destination' }}
            </h4>
          </div>

          <!-- Dynamically show all ride details -->
          <div class="ride-body">
            <div *ngFor="let key of getRideKeys(ride)">
              <p><strong>{{ formatKey(key) }}:</strong> {{ ride[key] }}</p>
            </div>
          </div>

          <div class="ride-footer">
            <button
              class="book-btn hover:scale-105 transition-all duration-200"
              (click)="bookRide(ride)"
            >
              üöó Book Now
            </button>

            <!-- Rating Display -->
            <!-- <p *ngIf="ride.avgRating > 0" class="rating-text"> -->
            ‚≠ê {{ ride.avgRating | number: '1.1-1' }}/5
            <!-- </p> -->
            <!-- <p *ngIf="ride.avgRating yallLocations=== 0" class="rating-text">‚≠ê No ratings yet</p> -->

            <!-- //this is for posting this Rating  -->
            <!-- <app-rating [rideId]="ride.rideId || ride.id"></app-rating> -->


            <div class="ride-footer">
              <button class="book-btn hover:scale-105 transition-all duration-200" (click)="bookRide(ride)">
                üöó Book Now
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Booking Request Modal -->
    <div class="booking-request-modal" *ngIf="incomingBooking">
      <div class="modal-content">
        <h3>New Booking Request</h3>
        <p><strong>Ride ID:</strong> {{ incomingBooking.rideId }}</p>
        <p><strong>User ID:</strong> {{ incomingBooking.userId }}</p>
        <p>Do you want to accept this booking?</p>
    <!-- üß© Booking Request Popup -->
    <div class="booking-request-modal" *ngIf="incomingBooking">
      <div class="modal-content">
        <h3>üöó New Booking Request</h3>
        <p><strong>Ride ID:</strong> {{ incomingBooking.rideId }}</p>
        <p><strong>User ID:</strong> {{ incomingBooking.userId }}</p>
        <p>Do you want to accept this booking?</p>

        <div class="modal-buttons">
          <button class="accept-btn" (click)="respondToBooking('Accepted')">
            ‚úÖ Accept
          </button>
          <button class="reject-btn" (click)="respondToBooking('Rejected')">
            ‚ùå Reject
          </button>
        </div>
      </div>
    </div>

    <!-- Error Message -->
    <div *ngIf="errorMessage" class="error-message">
      {{ errorMessage }}
    </div>

    <!-- Features Section -->
    <div class="features-section">
      <h2>Why Choose RideGeleya?</h2>
      <div class="features-container">
        <div class="feature">
          ‚ö°
          <h3>Lightning Fast</h3>
          <p>Find and book rides instantly with just a few clicks.</p>
        </div>
        <div class="feature">
          ‚úÖ
          <h3>100% Verified</h3>
          <p>All rides and users are verified for your safety.</p>
        </div>
        <div class="feature">
          üìç
          <h3>Real-time Tracking</h3>
          <p>Track your ride live and share location with friends.</p>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Login Modal -->
<div class="modal-backdrop" *ngIf="showLoginModal">
  <div class="modal-content">
    <app-login (close)="closeLoginModal()"></app-login>
  </div>
</div>
